# ‚úÖ Ollama Reranker - –¢–∞–π–º–∞—É—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω!

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
**–ë—ã–ª–æ**: `Request timeout has expired` –ø–æ—Å–ª–µ 15 —Å–µ–∫—É–Ω–¥  
**–°—Ç–∞–ª–æ**: –¢–∞–π–º–∞—É—Ç —É–≤–µ–ª–∏—á–µ–Ω –¥–æ 60 —Å–µ–∫—É–Ω–¥, —á—Ç–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è re-ranking

### 2. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ Ollama
**–ë—ã–ª–æ**: `NoTransformationFoundException` - –æ—à–∏–±–∫–∞ –¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏  
**–ü—Ä–∏—á–∏–Ω–∞**: Ollama –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `application/x-ndjson` –¥–∞–∂–µ —Å `stream=false`  
**–°—Ç–∞–ª–æ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `bodyAsText()` —Å —Ä—É—á–Ω—ã–º –ø–∞—Ä—Å–∏–Ω–≥–æ–º JSON

### 3. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ–º–ø—Ç
**–ë—ã–ª–æ**: 300 —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ —á–∞–Ω–∫  
**–°—Ç–∞–ª–æ**: 200 —Å–∏–º–≤–æ–ª–æ–≤ –Ω–∞ —á–∞–Ω–∫ –¥–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

### 4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
–¢–µ–ø–µ—Ä—å –≤—ã –≤–∏–¥–∏—Ç–µ:
```
‚è≥ Waiting for Ollama to re-rank candidates (this may take 30-60 seconds)...
‚úì Ollama responded in 35420ms (35s)
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
./gradlew clean build

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å Ollama re-ranking
export AILEARN_RAG_RERANKING=true
export AILEARN_RAG_RERANKING_PROVIDER=ollama
export AILEARN_RAG_RERANK_MODEL=qwen2.5
./gradlew run

# –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å
üí¨ –í—ã: —á—Ç–æ —Ç–∞–∫–æ–µ ailearn?

# –ü–æ–¥–æ–∂–¥–∏—Ç–µ 30-60 —Å–µ–∫—É–Ω–¥ –¥–ª—è re-ranking - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!
```

## ‚ö° –î–ª—è –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–π —Ä–∞–±–æ—Ç—ã

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ú–µ–Ω—å—à–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
export AILEARN_RAG_CANDIDATE_COUNT=10  # ~15-20 —Å–µ–∫—É–Ω–¥
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ú–µ–Ω—å—à–∞—è –º–æ–¥–µ–ª—å
```bash
export AILEARN_RAG_RERANK_MODEL=qwen2.5:3b  # ~20-30 —Å–µ–∫—É–Ω–¥
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: LlmProvider (–±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –ø–ª–∞—Ç–Ω–æ)
```bash
export AILEARN_RAG_RERANKING_PROVIDER=llm  # ~3-10 —Å–µ–∫—É–Ω–¥
```

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è | –ö–∞—á–µ—Å—Ç–≤–æ |
|--------------|-------|----------|
| **10 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ + qwen2.5:3b** | ~15-20s | –•–æ—Ä–æ—à–µ–µ ‚ö° |
| **15 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ + qwen2.5** | ~25-35s | –û—Ç–ª–∏—á–Ω–æ–µ ‚≠ê |
| **20 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ + qwen2.5** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) | ~35-45s | –û—Ç–ª–∏—á–Ω–æ–µ ‚úÖ |
| **20 –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ + qwen2.5:7b** | ~45-60s | –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ–µ üéØ |
| **LlmProvider** | ~3-10s | –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ–µ üíé |

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ö–æ–¥:
1. **src/main/kotlin/core/rag/LlmReranker.kt**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã (60 —Å–µ–∫—É–Ω–¥)
   - ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ –æ—Ç–≤–µ—Ç–∞ (`bodyAsText()` –≤–º–µ—Å—Ç–æ `body<T>()`)
   - ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ–º–ø—Ç (200 —Å–∏–º–≤–æ–ª–æ–≤)
   - ‚úÖ –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
1. **RAG_RERANKING_QUICK_REFERENCE.md**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –î–æ–±–∞–≤–ª–µ–Ω–æ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∞–π–º–∞—É—Ç–æ–º

2. **OLLAMA_RERANKER_UPDATED.md** (–Ω–æ–≤—ã–π)
   - –î–µ—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º
   - Troubleshooting —Å —Ä–µ—à–µ–Ω–∏—è–º–∏ –æ–±–µ–∏—Ö –ø—Ä–æ–±–ª–µ–º

3. **TIMEOUT_FIX.md** (–Ω–æ–≤—ã–π)
   - –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–±–æ–∏–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

4. **NDJSON_FIX.md** (–Ω–æ–≤—ã–π)
   - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å NDJSON
   - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è

5. **FIXED_SUMMARY.md** (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
   - –û–±—â–∞—è —Å–≤–æ–¥–∫–∞ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üí° –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å

- ‚è±Ô∏è Re-ranking —á–µ—Ä–µ–∑ Ollama **–∑–∞–Ω–∏–º–∞–µ—Ç 30-60 —Å–µ–∫—É–Ω–¥** - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!
- üéØ –ö–∞—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∞–µ—Ç—Å—è
- üí∞ –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ª–æ–∫–∞–ª—å–Ω–æ –∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- üîÑ –ü—Ä–∏ –æ—à–∏–±–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è cosine scores
- üìä –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

Ollama re-ranking —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ü—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∏ –Ω–µ–º–Ω–æ–≥–æ –ø–æ–¥–æ–∂–¥–∏—Ç–µ - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–æ–≥–æ —Å—Ç–æ—è—Ç!

–î–ª—è —Å–∞–º—ã—Ö –Ω–µ—Ç–µ—Ä–ø–µ–ª–∏–≤—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º:
```bash
export AILEARN_RAG_CANDIDATE_COUNT=10
export AILEARN_RAG_RERANK_MODEL=qwen2.5:3b
```

---

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã**:
- `TIMEOUT_FIX.md` - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- `OLLAMA_RERANKER_UPDATED.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `RAG_RERANKING_QUICK_REFERENCE.md` - –±—ã—Å—Ç—Ä–∞—è —Å–ø—Ä–∞–≤–∫–∞

